{% extends "base.html" %}

{% block title %}
    {{ name }}
{% endblock title %}

{% block head %}
    <link
        rel="stylesheet"
        href="{{ url_for('static', filename='ext/tabulator/css/tabulator_modern.min.css' ) }}"
    />
    <link
        rel="stylesheet"
        href="{{ url_for('static', filename='styles/review_text.css' ) }}"
    />
    <link
        rel="stylesheet"
        href="{{ url_for('static', filename='styles/buttons.css' ) }}"
    />
    <script src="{{ url_for('static', filename='ext/tabulator/js/tabulator.min.js') }}"></script>
    <script src="{{ url_for('static', filename='scripts/formatters.js') }}"></script>
    <script src="{{ url_for('static', filename='scripts/table.js') }}"></script>
{% endblock head %}

{% block content %}
    <div class="buttons-wrapper">
        <div class="buttons">
            {% for ext in urls.keys() %}
                <button class="download-button" onclick="window.open('{{ urls[ext] }}', '_blank')">{{ _("Download") }} {{ ext }}</button>
            {% endfor %}
            <button class="download-button"><a class="link-no-style" href="{{ url_for('product.charts', product_id=request.view_args['product_id']) }}">{{ _("Show graphs") }}</a></button>
        </div>
    </div>
  
    <div class="reviews-table-parent">
        <div id="reviews-table"></div>
    </div>
    <script>
        const tabledata = JSON.parse("{{ reviews | safe }}")

        for (let review of tabledata) {
            review.pros = review.pros.join(", ")
            review.cons = review.cons.join(", ")
        }

        const table = createTable("#reviews-table", tabledata, [
            { title: "{{ _('Id') }}", field: "id", headerFilter: "input", hozAlign: "center", width: 100 },
            { title: "{{ _('Author') }}", field: "author", headerFilter: "input", hozAlign: "center", width: 100,
                formatter: (cell) => text_formatter(cell, 12),
                cellClick: text_cell_click_handler 
            },
            { title: "{{ _('Recommend') }}", field: "recommend", headerFilter: "input", hozAlign: "center", width: 130,
                formatter: bool_formatter
            },
            { title: "{{ _('Stars') }}", field: "stars", headerFilter: "input", hozAlign: "center", formatter: "star", width: 90 },
            { title: "{{ _('Is Verified') }}", field: "is_verified", headerFilter: "input", hozAlign: "center", width: 160 },
            { title: "{{ _('Publish Date') }}", field: "published_datetime", headerFilter: "input", hozAlign: "center", width: 190 },
            { title: "{{ _('Purchase Date') }}", field: "purchase_datatime", headerFilter: "input", hozAlign: "center", width: 190 },
            { title: "{{ _('Likes') }}", field: "likes", headerFilter: "number", hozAlign: "center", width: 100 },
            { title: "{{ _('Disikes') }}", field: "dislikes", headerFilter: "number", hozAlign: "center", width: 100 },
            { title: "{{ _('Text') }}", field: "text", headerFilter: "input", width: 350,
                formatter: text_formatter,
                cellClick: text_cell_click_handler
            },
            { title: "{{ _('Pros') }}", field: "pros", headerFilter: "input", width: 185,
                formatter: text_formatter,
                cellClick: text_cell_click_handler
            },
            { title: "{{ _('Cons') }}", field: "cons", headerFilter: "input", width: 185,
                formatter: text_formatter,
                cellClick: text_cell_click_handler
            }
        ])
    </script>
{% endblock content %}

